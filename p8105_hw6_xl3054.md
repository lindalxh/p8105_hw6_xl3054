p8105_hw6_xl3054
================
Xinhui Lin (xl3054)
2025-12-03

# Problem 1

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
homicide = read_csv("data/homicide-data.csv") %>% 
  janitor::clean_names() %>%
  mutate(city_state = paste0(city, ", ", state),
         solved_bin = ifelse(disposition == "Closed by arrest", 1, 0),
         victim_age = ifelse(victim_age %in% c("Unknown", ""), NA, victim_age),
         victim_age = as.numeric(victim_age),
         victim_sex  = factor(victim_sex, levels = c("Female", "Male")),
         victim_race = factor(victim_race)) %>% 
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")),
         victim_race %in% c("White", "Black"))
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
homicide %>% 
  glm(solved_bin ~ victim_age + victim_sex + victim_race, 
      data = . , family = binomial) %>% 
  broom::tidy(conf.int = TRUE, exponentiate = TRUE) %>% 
  filter(term == "victim_sexMale") %>% 
  select(term, estimate, conf.low, conf.high) %>% 
  knitr::kable(digits = 4)
```

| term           | estimate | conf.low | conf.high |
|:---------------|---------:|---------:|----------:|
| victim_sexMale |   0.6028 |   0.5688 |    0.6388 |

``` r
## for each city
homicide_or = homicide %>% 
  group_by(city_state) %>% 
  nest() %>% 
  mutate(model = purrr::map(data, 
                            ~ glm(solved_bin ~ victim_age + victim_sex + victim_race,
                                  data   = .x,
                                  family = binomial)),
         tidied = purrr::map(model, ~ broom::tidy(.x, conf.int = TRUE, exponentiate = TRUE))) %>% 
  unnest(tidied) %>% 
  filter(term == "victim_sexMale") %>% 
  select(city_state, term, estimate, conf.low,conf.high) %>% 
  arrange(desc(estimate))

homicide_or %>% 
  knitr::kable(digits = 4)
```

| city_state         | term           | estimate | conf.low | conf.high |
|:-------------------|:---------------|---------:|---------:|----------:|
| Albuquerque, NM    | victim_sexMale |   1.7675 |   0.8247 |    3.7619 |
| Stockton, CA       | victim_sexMale |   1.3517 |   0.6256 |    2.9941 |
| Fresno, CA         | victim_sexMale |   1.3352 |   0.5673 |    3.0475 |
| Nashville, TN      | victim_sexMale |   1.0342 |   0.6807 |    1.5560 |
| Richmond, VA       | victim_sexMale |   1.0061 |   0.4835 |    1.9936 |
| Atlanta, GA        | victim_sexMale |   1.0001 |   0.6803 |    1.4583 |
| Tulsa, OK          | victim_sexMale |   0.9758 |   0.6091 |    1.5439 |
| Oklahoma City, OK  | victim_sexMale |   0.9741 |   0.6229 |    1.5200 |
| Minneapolis, MN    | victim_sexMale |   0.9470 |   0.4759 |    1.8810 |
| Indianapolis, IN   | victim_sexMale |   0.9187 |   0.6785 |    1.2413 |
| Charlotte, NC      | victim_sexMale |   0.8839 |   0.5507 |    1.3906 |
| Birmingham, AL     | victim_sexMale |   0.8700 |   0.5714 |    1.3138 |
| Savannah, GA       | victim_sexMale |   0.8670 |   0.4186 |    1.7802 |
| Las Vegas, NV      | victim_sexMale |   0.8373 |   0.6059 |    1.1511 |
| Durham, NC         | victim_sexMale |   0.8124 |   0.3824 |    1.6580 |
| Tampa, FL          | victim_sexMale |   0.8077 |   0.3395 |    1.8599 |
| Milwaukee, wI      | victim_sexMale |   0.7271 |   0.4951 |    1.0542 |
| Memphis, TN        | victim_sexMale |   0.7232 |   0.5261 |    0.9836 |
| Jacksonville, FL   | victim_sexMale |   0.7198 |   0.5359 |    0.9651 |
| Houston, TX        | victim_sexMale |   0.7110 |   0.5570 |    0.9057 |
| San Antonio, TX    | victim_sexMale |   0.7046 |   0.3928 |    1.2383 |
| St. Louis, MO      | victim_sexMale |   0.7032 |   0.5299 |    0.9319 |
| Washington, DC     | victim_sexMale |   0.6910 |   0.4660 |    1.0135 |
| Fort Worth, TX     | victim_sexMale |   0.6690 |   0.3935 |    1.1212 |
| Sacramento, CA     | victim_sexMale |   0.6688 |   0.3263 |    1.3144 |
| Boston, MA         | victim_sexMale |   0.6673 |   0.3508 |    1.2600 |
| Los Angeles, CA    | victim_sexMale |   0.6619 |   0.4565 |    0.9541 |
| San Francisco, CA  | victim_sexMale |   0.6075 |   0.3117 |    1.1551 |
| New Orleans, LA    | victim_sexMale |   0.5849 |   0.4219 |    0.8122 |
| Detroit, MI        | victim_sexMale |   0.5823 |   0.4619 |    0.7335 |
| Oakland, CA        | victim_sexMale |   0.5631 |   0.3637 |    0.8671 |
| Columbus, OH       | victim_sexMale |   0.5325 |   0.3770 |    0.7479 |
| Buffalo, NY        | victim_sexMale |   0.5206 |   0.2884 |    0.9358 |
| Miami, FL          | victim_sexMale |   0.5152 |   0.3040 |    0.8734 |
| San Bernardino, CA | victim_sexMale |   0.5003 |   0.1655 |    1.4624 |
| Philadelphia, PA   | victim_sexMale |   0.4963 |   0.3760 |    0.6499 |
| Louisville, KY     | victim_sexMale |   0.4906 |   0.3015 |    0.7836 |
| Denver, CO         | victim_sexMale |   0.4791 |   0.2327 |    0.9625 |
| Pittsburgh, PA     | victim_sexMale |   0.4308 |   0.2626 |    0.6956 |
| Baltimore, MD      | victim_sexMale |   0.4255 |   0.3242 |    0.5576 |
| San Diego, CA      | victim_sexMale |   0.4130 |   0.1914 |    0.8302 |
| Long Beach, CA     | victim_sexMale |   0.4102 |   0.1427 |    1.0242 |
| Chicago, IL        | victim_sexMale |   0.4101 |   0.3361 |    0.5009 |
| Cincinnati, OH     | victim_sexMale |   0.3998 |   0.2314 |    0.6670 |
| Omaha, NE          | victim_sexMale |   0.3825 |   0.1988 |    0.7109 |
| Baton Rouge, LA    | victim_sexMale |   0.3814 |   0.2043 |    0.6836 |
| New York, NY       | victim_sexMale |   0.2624 |   0.1328 |    0.4850 |

``` r
homicide_or %>% 
  ggplot(aes(x = reorder(city_state, estimate), y = estimate)) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
  geom_pointrange(aes(ymin = conf.low, ymax = conf.high)) +
  coord_flip() +
  labs(x = "City", y = "Adjusted odds ratio (male vs female)",
       title = "Adjusted OR for solving homicides (Male vs Female)") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 7))
```

![](p8105_hw6_xl3054_files/figure-gfm/unnamed-chunk-1-1.png)<!-- -->
